# æ´»åŠ¨çš„æœ€ä½³å®æˆ˜

## çŸ¥æ™“å½“å‰æ˜¯å“ªä¸€ä¸ªæ´»åŠ¨ - å°æŠ€å·§

ä¸€èˆ¬æ€§è¿›å…¥ä¸€ä¸ªå…¬å¸ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å»ç»´æŠ¤ç°æœ‰é¡¹ç›®. å‡å¦‚äº§å“æä¸ªéœ€æ±‚ï¼Œè®©ä½ å»æƒ³ä¿®æ”¹æŸä¸ªæ´»åŠ¨ä¸Šå†…å®¹æ—¶ï¼ŒåŠå¤©ä¹Ÿæ‰¾ä¸åˆ°ï¼Œé‚£è‚¯å®šä¸å¥½. ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•æŠ€å·§æ¥å¿«é€Ÿè§£å†³.

åœ¨ activityTest é¡¹ç›®çš„åŸºç¡€å»ä¿®æ”¹, åˆ›å»ºä¸€ä¸ªæ–°çš„ Activity,å–åå« ``BaseActivity``, ä»£ç å¦‚ä¸‹ï¼š

* 1 åˆ›å»º BaseActivity
``` java

package com.example.activitytest;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.util.Log;

public class BaseActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_base);
        Log.d("BaseActivity", getClass().getName());
    }
}

```
ğŸ‘†ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±åœ¨ onCreate() ä¸­æ‰“å°äº† ``getClass().getName()`` å€¼.

* 2 ä¿®æ”¹ FristActivityã€SecondeActivityã€ThirdActivity æŠŠç»§æ‰¿ AppCompatActivity å¯¹è±¡æ”¹æˆ BaseActivity

å› ä¸º ``BaseActivity`` ç»§æ‰¿äº† ``AppCompatActivity``, æ‰€ä»¥ç»§æ‰¿ BaseActivity ç›¸å½“äºé—´æ¥ç»§æ‰¿ AppCompatActivity ç‰¹æ€§ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå½±å“åŠŸèƒ½ä½¿ç”¨.

* 3 é‡æ–°å¯åŠ¨åº”ç”¨
* 4 å½“æ¯å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨æ—¶ï¼Œæ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š

``` log

2019-11-25 22:16:09.253 22002-22002/com.example.activitytest D/BaseActivity: com.example.activitytest.FristActivity
2019-11-25 22:16:19.947 22002-22002/com.example.activitytest D/BaseActivity: com.example.activitytest.SecondActivity
2019-11-25 22:16:21.216 22002-22002/com.example.activitytest D/BaseActivity: com.example.activitytest.ThirdActivity

```

## éšæ—¶éšåœ°é€€å‡ºç¨‹åº

å‡å¦‚æˆ‘ä»¬ç°åœ¨åº”ç”¨å¤„äº ``ThirdActivity`` æ´»åŠ¨, æ„å‘³ç€æˆ‘ä»¬éœ€è¦æŒ‰ä¸‰æ¬¡ ``Back`` é”®æ‰èƒ½é€€å‡ºåº”ç”¨. è€ŒæŒ‰ Home é”®åªä¼šæŒ‚èµ·ç¨‹åºï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•åšåˆ°éšæ—¶éšåœ°é€€å‡ºç¨‹åºï¼Ÿ é€šè¿‡é›†åˆæ¥ç®¡ç†æ´»åŠ¨ï¼Œæ¯å¯åŠ¨æ´»åŠ¨æ”¾å…¥é›†åˆä¸­ï¼Œè¿™æ ·æ— éå°±æ˜¯çŸ¥é“å½“å‰æ´»åŠ¨æœ‰é‚£äº›ï¼Œé€€å‡ºæ—¶åªéœ€è¦ä¸€ä¸ªä¸€ä¸ªæŠŠå¾ªç¯ ``finish()`` å°±å¯ä»¥äº†.

å…ˆæ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å™¨(ActivityCollector)æ¥æ”¶é›†æ´»åŠ¨:

``` java

package com.example.activitytest;
import android.app.Activity;
import java.util.ArrayList;
import java.util.List;

public class ActivityCollector {
   public static List<Activity> activities = new ArrayList<>();

   public static void addActivity(Activity activity) {
       activities.add(activity);
   }
   public  static void removeActivity(Activity activity){
       activities.remove(activity);
   }
   public  static void finishAll() {
       for(Activity activity : activities) {
           if(!activity.isFinishing()){
               activity.finish();
           }
       }
       activities.clear();
   }
}

```

ä»€ä¹ˆä½ç½®æ¥æ”¶é›†æ´»åŠ¨?  BaseActivity ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯æ‰€æœ‰æ´»åŠ¨çš„çˆ¶ç±».  BaseActivityä»£ç ä¿®æ”¹å¦‚ä¸‹:

``` java

public class BaseActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_base);
        Log.d("BaseActivity", getClass().getName());
        ActivityCollector.addActivity(this);
    }

    @Override
    protected  void onDestroy() {
        super.onDestroy();
        ActivityCollector.removeActivity(this);
    }
}

```

è¿™æ ·åŸºæœ¬ä»£ç å°±å®Œæˆï¼Œå‡å¦‚æˆ‘ä»¬æƒ³å†ä»»ä½•ä¸€ä¸ªåœ°æ–¹é€€å‡ºç¨‹åºçš„è¯ï¼Œåªéœ€è¦è°ƒç”¨ ``ActivityCollector.finishAll()``. å…¶æ¬¡å¯ä»¥åœ¨é”€æ¯æ‰æ‰€æœ‰æ´»åŠ¨çš„åé¢åŠ ä¸Š ``android.os.Process.killProcess(Process.myPid())`` æ€æ‰å½“å‰çš„è¿›ç¨‹.


## å¯åŠ¨æ´»åŠ¨çš„æœ€ä½³åŠæ³•

åœ¨ä¼ é€’æ•°æ®é‚£ç« æåŠäº†ï¼Œå¯åŠ¨æ´»åŠ¨æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š startActivity ã€startActivityForResult. è€Œå¦‚æœéœ€è¦ä»ä¸€ä¸ªæ´»åŠ¨ä¼ é€’æ•°æ®åˆ°å¦å¤–ä¸€ä¸ªæ´»åŠ¨æ—¶å¯ä»¥å€ŸåŠ© Indentæ¥å®Œæˆ.

å‡å¦‚ï¼ŒSecondActivity åœ¨å¯åŠ¨æ—¶éœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå¯èƒ½æˆ‘ä»¬ä¸€èˆ¬åšæ³•æ˜¯è¿™æ ·:

``` java

    final Intent intent = new Intent(FristActivity.this, SecondActivity.class);
    intent.putExtra("params1", "Hello SecondActivity");
    intent.putExtra("params2", "My FristActivity");
    startActivity(intent);

```
é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯è¿™æ ·å†™ï¼Œä»å„ä¸ªå±‚é¢æ¥è¯´éƒ½æ˜¯æ­£ç¡®çš„. é‚£ä¹ˆå®ƒæœ‰æ²¡æœ‰ä¸å¥½åœ°æ–¹å°¼?  ç°åœ¨ ``SecondActivity`` æ˜¯è‡ªå·±å†™çš„ï¼Œæ˜¯çŸ¥é“ä¼ ä»€ä¹ˆéœ€è¦ä»€ä¹ˆå‚æ•°ç­‰. å‡å¦‚è¿™ä»£ç æ˜¯åŒäº‹å¼€å‘çš„ï¼Œé‚£ä¹ˆè¦æƒ³çŸ¥é“ä¼ ä»€ä¹ˆå‚æ•°ã€ä»¥åŠå‚æ•°ä¸ªæ•°. é€šå¸¸åšæ³•ï¼š

* 1: çœ‹æºç 
* 2: é—®åŒäº‹

æ— è®ºé‚£ç§æ–¹å¼éƒ½æ˜¯è€—æ—¶. é‚£ä¹ˆæœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„æ–¹å¼å‘¢?  åœ¨ä¸é—®åŒäº‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ¸…æ™°çŸ¥é“ä¼ é€’å“ªäº›å‚æ•°. ğŸ‘‡æˆ‘ä»¬ä¿®æ”¹ä¸‹ï¼š

```java

    public static void actionStart(Activity context, String params1, String params2){
        Intent intent = new Intent(context, SecondActivity.class);
        intent.putExtra("params1", params1);
        intent.putExtra("params2", params2);
        context.startActivity(intent);
    }

```

æ·»åŠ ä¸€ä¸ªå¯åŠ¨å‡½æ•°, è¿™æ ·å°±ä¸€ç›®äº†ç„¶å•¦.  çŸ¥é“ä¼ ä»€ä¹ˆå‚æ•°, åŒæ—¶è¿™ç§å†™æ³•ä¹Ÿç®€åŒ–äº†æˆ‘ä»¬è°ƒç”¨.

``` java

 @Override

    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.frist_layout);

        Button button1 = (Button)  findViewById(R.id.button_1);
        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                SecondActivity.actionStart(FristActivity.this, "123", "345");
            }
        });
    }

```

