# æ´»åŠ¨å¯åŠ¨æ¨¡å¼

å¯åŠ¨æ¨¡å¼ä¸»è¦åˆ†ä¸º 4 ç§, åˆ†åˆ«æ˜¯ æ ‡å‡†å¯åŠ¨æ¨¡å¼ï¼ˆstandardï¼‰ã€singleTopã€singleTaskã€singleInstance, å¯ä»¥åœ¨ AndroidManifast.xml ä¸­é€šè¿‡ ``android:launchMode`` è¿›è¡ŒæŒ‡å®š Activity çš„å¯åŠ¨æ–¹å¼.

## standard ï¼ˆé»˜è®¤çš„å¯åŠ¨æ–¹å¼ï¼‰

*   é»˜è®¤æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ²¡æ˜¾ç¤ºæŒ‡å®šå¯åŠ¨æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæ´»åŠ¨éƒ½æ˜¯å·²æ ‡å‡†çš„æ–¹å¼å¯åŠ¨
*   Androidæ˜¯é€šè¿‡``è¿”å›æ ˆ``æ¥ç®¡ç†æ´»åŠ¨çš„ï¼Œåœ¨standardæ¨¡å¼ä¸‹ï¼Œæ¯å½“å¯åŠ¨ä¸€ä¸ªæ–°çš„æ´»åŠ¨å°±ä¼šåŠ å…¥åˆ°``è¿”å›æ ˆ``çš„é¡¶éƒ¨ï¼Œå¯¹äºä½¿ç”¨ standardæ¨¡å¼çš„æ´»åŠ¨ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šåœ¨ä¹å¯è¿™ä¸ªæ´»åŠ¨æ˜¯å¦åœ¨è¿”å›æ ˆä¸­ï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹.

ä¸‹é¢å¯ä»¥é€šè¿‡å®ä¾‹æ¥çœ‹çœ‹

* 1 åœ¨ FristActivity ä¸­ä¿®æ”¹ä»£ç å¦‚ä¸‹

``` java

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.frist_layout);
        // æ‰“å°å¯¹è±¡å­—ç¬¦ä¸²å½¢å¼
        Log.d("FristActivity", this.toString());

        Button button1 = (Button)  findViewById(R.id.button_1);
        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                final Intent intent = new Intent(FristActivity.this, FristActivity.class);
                startActivity(intent);
            }
        });
```

* 2 è¿ç»­ç‚¹å‡»ç•Œé¢ä¸Šçš„ ``Button1`` æŒ‰é’®
* 3 æ§åˆ¶å°è¾“å…¥å†…å®¹å¦‚ä¸‹

![avatar](img/standard_log.png)

å¯ä»¥çœ‹åˆ°ç‚¹å‡»å¤šå°‘æ¬¡,æ‰“å°å‡ºå¾—å¯¹è±¡éƒ½ä¸ä¸€æ ·. ä¹Ÿå°±è¯´æ˜æ¯å¯åŠ¨ä¸€æ¬¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹.

standardæ¨¡å¼çš„ç¤ºæ„å›¾:

![avatar](img/standard_mode.png)

## singleTop

*   å½“å¯åŠ¨çš„æ´»åŠ¨å·²å¤„äºæ ˆé¡¶, é‚£ä¹ˆç³»ç»Ÿä¸ä¼šå†æ–°åˆ›å»ºå®ä¾‹,è€Œæ˜¯ä¼šç›´æ¥å¤ç”¨.

*   å¦‚æœä¸åœ¨æ ˆé¡¶ï¼Œå³ä½¿å¯åŠ¨çš„æ´»åŠ¨å·²å­˜åœ¨æ ˆä¸­ä¾ç„¶è¿˜æ˜¯ä¼šåˆ›å»ºæ–°çš„å®ä¾‹

ğŸ‘‡é€šè¿‡å®ä¾‹æ¥çœ‹çœ‹

* 1 åœ¨ AndrodMainfest.xml ä¸­ä¿®æ”¹ FristActivity çš„å¯åŠ¨æ¨¡å¼

``` xml

    <activity
        android:name=".FristActivity"
        android:launchMode="singleTop"
        android:label="@string/app_name">
        <intent-filter>
            <!-- è¡Œä¸º -->
            <action android:name="android.intent.action.MAIN" />
            <!-- ç±»ç›® -->
            <category android:name="android.intent.category.LAUNCHER" />
        </intent-filter>
    </activity>

```

* 2 è¿ç»­ç‚¹å‡»ç•Œé¢ä¸Šçš„ ``Button1`` æŒ‰é’®
* 3 æ§åˆ¶å°è¾“å…¥å†…å®¹å¦‚ä¸‹

![avatar](img/singleTop_mode_log01.png)

ä»æ‰“å°è¾“å…¥çš„ç»“æœæ¥çœ‹ï¼Œå¹¶æ²¡æœ‰é‡å¤æ‰“å°.

ğŸ‘‡å†ä¿®æ”¹ä¸‹å®ä¾‹æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå½“å­˜åœ¨æ ˆä¸­ä½†ä¸å¤„äºæ ˆé¡¶æ—¶ï¼Œè¿˜ä¼šä¸ä¼šå†åˆ›å»ºä¸€ä¸ªå®ä¾‹.

* 1 åŒæ—¶ä¿®æ”¹ä¸‹ ``FristActivity``, ``SecondActivity`` ä¸­çš„ onCreated æ–¹æ³•, å¦‚ä¸‹

``` java
    // FristActivity
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // æŒ‡å®šå¸ƒå±€æ–‡ä»¶
        // é¡¹ç›®ä¸­æ·»åŠ çš„ä»»ä½•èµ„æºæ–‡ä»¶éƒ½ä¼šåœ¨ R æ–‡ä»¶ä¸­.
        setContentView(R.layout.frist_layout);
        Log.d("FristActivity", this.toString());
        Button button1 = (Button)  findViewById(R.id.button_1);
        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                /**
                    * 1 å¯åŠ¨æ´»åŠ¨æ–¹å¼ startActivityForResult(Intent, Bound)  ç¬¬ä¸€ä¸ªå¯åŠ¨å“ªä¸ªIntentï¼Œ ç¬¬äºŒä¸ªæ˜¯è¯·æ±‚ç ä¸»è¦ç”¨ä¸è¿”å›ç»“æœçš„å›è°ƒä¸­åˆ¤æ–­è¿”å›çš„æ¥æº
                    * 2 é‡å†™ onActivityResult æ¥æ”¶è¿”å›å€¼
                    */

                final Intent intent = new Intent(FristActivity.this, SecondActivity.class);
                startActivity(intent);
            }
        });
    }

```

``` java
    // SecondActivity

    Button button1 = (Button)  findViewById(R.id.button_1);
    button1.setOnClickListener(new View.OnClickListener() {
        @Override
        public void onClick(View v) {

            /**
                * 1 å¯åŠ¨æ´»åŠ¨æ–¹å¼ startActivityForResult(Intent, Bound)  ç¬¬ä¸€ä¸ªå¯åŠ¨å“ªä¸ªIntentï¼Œ ç¬¬äºŒä¸ªæ˜¯è¯·æ±‚ç ä¸»è¦ç”¨ä¸è¿”å›ç»“æœçš„å›è°ƒä¸­åˆ¤æ–­è¿”å›çš„æ¥æº
                * 2 é‡å†™ onActivityResult æ¥æ”¶è¿”å›å€¼
                */

            final Intent intent = new Intent(FristActivity.this, FristActivity.class);
            startActivity(intent);
        }
    });

```

* é‡å¯åº”ç”¨ï¼Œå…ˆç‚¹å‡» ``Button 1`` å†ç‚¹å‡» ``Button 2``
* æ§åˆ¶å°è¾“å‡ºç»“æœ

![avatar](img/singleTop_mode_log02.png)

singleTopæ¨¡å¼çš„åŸç†ç¤ºæ„å›¾ï¼š

![avatar](img/singleTop_mode.png)


## singleTask

å‰é¢ ``singleTop`` åªæœ‰å½“æ´»åŠ¨å¤„äºæ ˆé¡¶æ—¶å¯ä»¥è¢«å¤ç”¨ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼åªè¦å½“å‰æ´»åŠ¨å¤„äºæ ˆä¸­å°±å¯ä»¥è¢«å¤ç”¨? ``singleTask``.

### singleTask å·¥ä½œæµç¨‹

å½“æ´»åŠ¨å¯åŠ¨æ¨¡å¼æ˜¯ ``singleTask``æ—¶ï¼Œæ¯æ¬¡å¯åŠ¨è¯¥æ´»åŠ¨æ—¶éƒ½ä¼šå»``è¿”å›æ ˆ``ä¸­å…ˆæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±ç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹ï¼Œå¹¶æŠŠåœ¨è¿™ä¸ªæ´»åŠ¨ä¸Šé¢çš„æ‰€æœ‰æ´»åŠ¨ç»Ÿç»Ÿå‡ºæ ˆï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±é‡æ–°åˆ›å»ºä¸€ä¸ª.

ğŸ‘‡æˆ‘ä»¬é€šè¿‡ä»£ç ç›´è§‚äº†è§£ä¸‹, åœ¨åŸæ¥åŸºç¡€ä¸Šä¿®æ”¹ä¸‹ FristActivity å¯åŠ¨æ–¹å¼.

* 1 ä¿®æ”¹ AndroidManifest.xml æ–‡ä»¶
``` xml

<activity
    android:name=".FristActivity"
    android:launchMode="singleTask"
    android:label="@string/app_name">
    <intent-filter>

        <!-- è¡Œä¸º -->
        <action android:name="android.intent.action.MAIN" />
        <!-- ç±»ç›® -->
        <category android:name="android.intent.category.LAUNCHER" />
    </intent-filter>
 </activity>

```
* 2 ä¿®æ”¹ SecondActivity, è§‚å¯Ÿä¸‹æ˜¯å¦ä¼šæ‰§è¡Œ onDestory()æ–¹æ³•ï¼ˆå‡ºæ ˆï¼‰

``` java

   @Override
    protected void onDestroy() {
        super.onDestroy();
        Log.d("SecondeActivity", "onDestroy");
    }

```

* 3 é‡æ–°å¯åŠ¨åº”ç”¨
* 4 ç‚¹å‡» Button1 -> SecondActivity -> Button2
* 5 æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

![avatar](img/singleTask_log.png)
![avatar](img/singleTask_log2.png)

``singleTask`` å¤§æ¦‚æµç¨‹å›¾å¦‚ä¸‹ï¼š

![avatar](img/singleTask.png)


## singleInstance

è¿™ç§åº”è¯¥è¿™å››ç§ä¸­æœ€ç‰¹æ®ŠåŒæ—¶ä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ª.  å½“é‡åˆ°``singleInstance``æ´»åŠ¨æ—¶ï¼Œ ç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„``è¿”å›æ ˆ``æ¥ç®¡ç†è¿™ä¸ªæ´»åŠ¨.

é‚£ä¹ˆè¿™æ ·åšæœ‰ä»€ä¹ˆæ„ä¹‰?

å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ´»åŠ¨æ˜¯å…è®¸``å…¶å®ƒç¨‹åº``è°ƒç”¨çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å®ç°å…¶å®ƒç¨‹åºå’Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥å…±äº«è¿™ä¸ªæ´»åŠ¨çš„å®ä¾‹ï¼Œåº”è¯¥å¦‚ä½•å®ç°å‘¢? ä½¿ç”¨å‰é¢ä¸‰ç§å¯åŠ¨æ¨¡å¼è‚¯å®šæ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„è¿”å›æ ˆï¼ŒåŒä¸€ä¸ªæ´»åŠ¨åœ¨ä¸åŒçš„è¿”å›æ ˆä¸­è‚¯å®šä¼šæ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹. è€Œä½¿ç”¨ ``singleInstance`` æ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹å•ç‹¬æœ‰ä¸€ä¸ª``è¿”å›æ ˆ``æ¥ç®¡ç†,ä¸ç®¡é‚£ä¸ªç¨‹åºæ¥è®¿é—®éƒ½ä¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹.

é‚£ä¹ˆæ€ä¹ˆæµ‹è¯•ä¸‹ä¸Šé¢æè¿°æ˜¯å¦æ­£ç¡®ğŸ™†ï¼Ÿ å¯ä»¥é€šè¿‡æŸ¥çœ‹ taskId æ¥å¾—åˆ°ç­”æ¡ˆ(å‰é¢è¯´åˆ°è¿‡ï¼Œé€šè¿‡ä»»åŠ¡æ–¹å¼æ¥ç®¡ç†æ´»åŠ¨æ ˆçš„).

ğŸ‘‡ é€šè¿‡ä¸‹é¢ä¸€ä¸ªå®ä¾‹æ¥ç†Ÿæ‚‰ä¸‹ï¼š

* 1 ä¿®æ”¹ä¸‹ ``AndriodManifest.xml`` , æŠŠ SecondeActivity å¯åŠ¨æ–¹å¼æ”¹ä¸º ``singleInstance``

``` xml

    <activity
        android:name=".SecondActivity"
        android:launchMode="singleInstance"
        android:label="@string/title_activity_second">
        <intent-filter>
            <action android:name="android.intent.ACTION_START" />

            <category android:name="android.intent.category.DEFAULT" />
            <category android:name="com.example.activitytest.MY_CATEGORY" />
        </intent-filter>
    </activity>

```
* 2 åœ¨ FristActivityã€SecodeActivityã€ThirdActivity ä¸­çš„ ``onCreate()`` æ‰“å° taskId å€¼.

``` java

 Log.d("FristActivity", "This is TaskId: " + getTaskId());
 Log.d("SecondActivity", "This is TaskId: " + getTaskId());
 Log.d("ThirdActivity", "This is TaskId: " + getTaskId());

```
* 3 é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åº
* 4 FristActivity ä¸­ç‚¹å‡» Button1 -> SecondActivity ç‚¹å‡» Button2 -> ThirdActivity
* 5 æ§åˆ¶å°è¾“å‡ºæ—¥å¿—

``` log

2019-11-25 21:46:15.445 20866-20866/com.example.activitytest D/FristActivity: This is TaskId: 94
2019-11-25 21:46:33.754 20866-20866/com.example.activitytest D/SecondActivity: This is TaskId: 95
2019-11-25 21:46:38.414 20866-20866/com.example.activitytest D/ThirdActivity: This is TaskId: 94

```

å¯ä»¥ç›´è§‚çœ‹å‡ºæ¥, ``SecondeActivity`` taskId æ˜¯ä¸ä¸€æ ·,ä¹Ÿè¯´æ˜å®ƒå¤„åœ¨ä¸åŒçš„è¿”å›æ ˆä¸­.


ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ³¨æ„ï¼Œ å½“æˆ‘ä»¬æŒ‰ ``Back`` é”®æ—¶ï¼Œè¿”å›æµç¨‹æ˜¯è¿™æ ·ï¼š

> ThirdActivity -> FristActivity -> SecondActivity

ä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·?

å› ä¸º ThirdActivity å’Œ FristActivity æ˜¯åœ¨åŒä¸€ä¸ªæ ˆä¸­ï¼Œå½“ ThirdActivity å‡ºæ ˆ,é‚£ä¹ˆ FristActivity å°±åˆ°æ¥æ ˆé¡¶ä½ç½®, å½“å†æŒ‰ä¸€ä¸‹ ``Back`` é”®æ—¶å‰ä¸€ä¸ªè¿”å›æ ˆç©ºäº†, è¿›å…¥ä¸‹ä¸€ä¸ªè¿”å›æ ˆ ``SecondActivity`` å‘ˆç°ç»™ç”¨æˆ·ï¼Œå†æŒ‰ä¸€ä¸‹ ``Back`` ç¨‹åºé€€å‡º.

``singleInstance`` å¤§æ¦‚æµç¨‹å¦‚ä¸‹å›¾ï¼š

![avatar](img/singleInstance.png)



